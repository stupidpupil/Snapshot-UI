<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	
	
	<link rel="icon" type="image/png" href="/static/img/logo.png"/>

	<link rel="stylesheet" href="/static/layout.css" type="text/css" />
	<link rel="stylesheet" href="/static/aristo.css" type="text/css" />
	<link rel="stylesheet" href="/static/coderay.css" type="text/css" />
		

	<script type="text/ecmascript" src="/static/js/3rd/humanedates.js"></script>
	                                            
	<script type="text/ecmascript" src="/static/js/3rd/jquery.js"></script>
	<script type="text/ecmascript" src="/static/js/3rd/jquery.tmpl.js"></script>
	<script type="text/ecmascript" src="/static/js/3rd/knockout.js"></script>

	<script type="text/ecmascript" src="/static/js/3rd/tablesort.js"></script>
                                                
	<script type="text/ecmascript" src="/static/js/3rd/yui.js"></script>

	<script type="text/ecmascript" src="/static/js/ajax/about.js"></script>
	<script type="text/ecmascript" src="/static/js/ajax/diff.js"></script>
	<script type="text/ecmascript" src="/static/js/ajax/info.js"></script>
	<script type="text/ecmascript" src="/static/js/ajax/link.js"></script>
	<script type="text/ecmascript" src="/static/js/ajax/preview.js"></script>
	<script type="text/ecmascript" src="/static/js/ajax/snapshots.js"></script>

	<script type="text/ecmascript" src="/static/js/changeHandlers.js"></script>
	<script type="text/ecmascript" src="/static/js/helpers.js"></script>
	<script type="text/ecmascript" src="/static/js/initialize.js"></script>
	<script type="text/ecmascript" src="/static/js/layout.js"></script>
	
	
	
	<script type="text/javascript">
	<![CDATA[	
	
	    var viewModel = {
	        snapshots : ko.observableArray([]),
	        versions : ko.observableArray([]),
			selectedSnapshot : {"leftPanel" : ko.observable(), "rightPanel" : ko.observable()},
			entries : {"leftPanel" : ko.observableArray([]), "rightPanel" : ko.observableArray([])},
			info : {"leftPanel" : ko.observable(), "rightPanel" : ko.observable()},
			detailsVisible : {"leftPanel" : ko.observable(), "rightPanel" : ko.observable()},
			diffable : ko.observable(),
			needsSnapshotSelection : {"leftPanel" : ko.observable(), "rightPanel" : ko.observable()},
			showSnapshotsAs : ko.observable()
	    };
	
		ko.bindingHandlers['fadeInVisible'] = {

		    'update': function(element, valueAccessor) {
				if(valueAccessor()()){
		        	$(element).fadeIn(300);
				}else{
		        	$(element).hide();
				}

		    }

		};
	
		//
		//	Ensures that we don't leave the other detailsView in 'diff' mode if one changes
		//
		
		viewModel.detailsVisible.leftPanel.subscribe(function(newValue){
			if(newValue != 'diff'){
				if (viewModel.detailsVisible.rightPanel() == 'diff'){
					setDetailsViewToDefault('rightPanel')
				}
			}
		})
		
		viewModel.detailsVisible.rightPanel.subscribe(function(newValue){
			if(newValue != 'diff'){
				if (viewModel.detailsVisible.leftPanel() == 'diff'){
					setDetailsViewToDefault('leftPanel')
				}
			}
		})
	
		function refreshLeftPanelSort(){
			refreshSortingForPanel("leftPanel")
		}
		
		function refreshRightPanelSort(){
			refreshSortingForPanel("rightPanel")
		}
	
		function refreshSortingForPanel(panelId){
				fdTableSort.prepareTableData(getElementForPanelAndClass(panelId, "directoryEntriesBody").parentNode);
	    		fdTableSort.jsWrapper(getElementForPanelAndClass(panelId, "directoryEntriesBody").parentNode.id, 0);
		}
		]]>
		
	</script>
	
	
	<!-- infoBox Template -->
	<script type="application/xhtml+xml" id="infoTemplate">
	<![CDATA[	
	
		<div class="innerDiv" data-bind="css: {directory: mimetype == 'application/x-directory', file: mimetype != 'application/x-directory', previewable:preview}">
		<span class="filenameSpan" data-bind="text:filename"></span>
		<span class="mtimeSpan">${mtime.toUTCString()}</span>
		<div class="buttons">
		<a class="button" data-bind="click: function () {loadPreview($item.panel)}, visible: (preview && $item.detailsVisible() != 'preview')" >Show Preview…</a>
		<a class="button" data-bind="click: function() {viewModel.detailsVisible[$item.panel]('info')}, visible: $item.detailsVisible() != 'info'">Show Info…</a>
		<a class="button" data-bind="click: function() {viewModel.detailsVisible[$item.panel]('entries')}, visible: (mimetype == 'application/x-directory' && $item.detailsVisible() != 'entries')">Show Contents…</a>				

		{{if $item.panel == 'rightPanel' && $item.diffable}}
		<a class="button" data-bind="click: function() {loadDiff()}, visible: viewModel.detailsVisible[$item.panel]() != 'diff'">Show Diff…</a>				
		{{/if}}
		</div>
		<a class ="downloadLink" href="/download/${link}"/>
		</div>
		
		]]>
		
	</script>
	
	
	<!-- Details Templates -->
	
	<script type="application/xhtml+xml" id="detailsTemplate">
	<![CDATA[	
		<tr>
			<td>Kind</td>
			<td data-bind="text:kind"></td>
		</tr>
		
		<tr>
			<td>Size</td>
			<td data-bind="text:bytesToSize(parseInt(size, 10)) + ' (' + size + ' bytes)'"></td>
		</tr>
		
		
		
	]]>
	</script>
	
	<!-- Entries Templates -->
	
	<script type="application/xhtml+xml" id="entryTemplate">
	<![CDATA[	
		<tr data-bind="click: function() { changePath(gPath + '/' + filename);}">
			<td data-bind="css:{folder:folder, document:!folder}, text:filename"></td>
			<td>${mtime.toUTCString()}</td>
			<td>{{if size}}${bytesToSize(parseInt(size, 10))}{{else}}--{{/if}}</td>
		</tr>
	]]>
	</script>
	
	<!-- Sidebar Templates -->
	
	<script type="application/xhtml+xml" id="sidebarTemplate">
	<![CDATA[	
		{{if $item.snapshots().length == 0}}
			<h2>Loading…</h2>
		{{else}}
			{{if $item.versions().length == 0}}
				<div class="snapshots" data-bind="template: {name: 'snapshotsTemplate', templateOptions:{selectedID: $item.selectedSnapshot[$item.panel], panel:$item.panel}, data:$item.snapshots}"></div>        	
			{{else}}
				<div class="snapshots" data-bind="template: {name: 'versionTemplate', templateOptions:{selectedID: $item.selectedSnapshot[$item.panel], panel:$item.panel}, foreach:$item.versions}"></div>        
			{{/if}}
		{{/if}}
	]]>
	</script>
	
	<script type="application/xhtml+xml" id="snapshotsTemplate">
		<![CDATA[
			<h2>Snapshots</h2>
				<div class="snapshots" data-bind="template: {name: 'snapshotTemplate', templateOptions:{selectedID: $item.selectedID, panel:$item.panel}, afterAdd:refreshLeftPanelSort, foreach:$data}"></div>        
		]]>
	</script>
	
	
	<script type="application/xhtml+xml" id="snapshotTemplate">
		<![CDATA[
	    <a data-bind="css: { selected: snapId === $item.selectedID() }, click: function() { changeSnapshot($item.panel, snapId);}, text: viewModel.showSnapshotsAs() == 'date' ? humaneDate(iso8601) : name"></a>	
		]]>
	</script>
	
	<script type="application/xhtml+xml" id="versionTemplate">
		<![CDATA[
		<h2>Version ${i}</h2>
			<div class="snapshots" data-bind="template: {name: 'snapshotTemplate', templateOptions:{selectedID: $item.selectedID, panel:$item.panel}, foreach:$data}"></div>        
		]]>
	</script>
	
	<!-- Panel template -->
	
</head>

<body>
	<div id="header">
		<h1 id="serverName">
		Snapshot WebUI
		</h1>
		<div id="rightHandHeader" >
			
			<a class="headerButton" onclick="showRightPanel(!gShowingRightPanel, true);">
				<img id="splitPaneButton" src="/static/img/twoPane.png" title="Toggle Splitpane View"/>
			</a>
			
			<a class="headerButton" onclick="orderSheetOut('aboutSheet', true)">
				<img src="/static/img/about.png" title="Show About…"/>
			</a>
						
		</div>

	</div>
	
	<div id="aboutSheet" class="sheet">
		<h2>Snapshot WebUI</h2>
		<p>By <a href="http://www.stupidpupil.co.uk">Adam Watkins</a>, licensed under <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2</a>.</p>
		
		<p>Uses icons from 
		<ul>	
		<li>'Fugue' by <a href="http://p.yusukekamiyamane.com/">Yusuke Kamiyamane</a>, licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3</a>,</li>
		<li>'Project' by <a href="http://bogo-d.deviantart.com">Mihaiciuc Bogdan</a>, licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3</a>,</li>
		
		<li>and the <a href="http://launchpad.net/candyproject">Candy Project</a>, licensed under <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2</a>.</li>
		</ul>
		</p>
		
		<p>Incorporates <a href="http://www.redmine.org/projects/redmine/repository/revisions/1516">code</a> from <a href="http://www.redmine.org">Redmine</a>, licensed under <a href="http://www.gnu.org/licenses/gpl-2.0.html">GPLv2</a>.</p>

		<p>Uses <a href="http://www.frequency-decoder.com/2006/09/16/unobtrusive-table-sort-script-revisited">table-sorting code</a> by <a href="http://www.frequency-decoder.com">Brian McAllister</a>, licensed under <a href="https://creativecommons.org/licenses/by-sa/2.5/">CC BY-SA 2.5</a>.</p>

		<p>Uses the <a href="http://developer.yahoo.com/yui/3/">Yahoo! UI Library</a>, licensed under <a href="http://developer.yahoo.com/yui/license.html">BSD-style</a>.</p>
		
		<p>Uses <a href="https://github.com/zachleat/Humane-Dates">Humane Dates</a> by <a href="http://zachleat.com">Zach Leatherman</a>, licensed under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT license</a>.</p>
		
		
			<a class="button" onclick="orderSheetOut('aboutSheet', false)">Close</a>
	
	
	</div>
	
	<div id="errorSheet" class="sheet">
		<h2 id="errorHeader">Error loading Snapshots</h2>
		<p id="errorDescription">The server return an error whilst loading snapshots.</p>
		<a class="button" onclick="orderSheetOut('errorSheet', false)" >OK</a>
		
	</div>
	
	<div id="diffContainer" data-bind="visible: (detailsVisible['leftPanel']() == 'diff' &amp;&amp; detailsVisible['rightPanel']() == 'diff' &amp;&amp; diffable)">
		<div id="diffContent"/>
	</div>
	
	<span id="pathComponents">
	</span>
	
	
	<div id="leftPanel" class="panel">
		

		<div class="sidebar" data-bind="template: {name: 'sidebarTemplate', templateOptions:{panel:'leftPanel', snapshots:snapshots, versions:versions, selectedSnapshot:selectedSnapshot}}">

		</div>
		
		<div class="notSidebar">
			
			<div data-bind="fadeInVisible: info['leftPanel']">
				<div class="infoBox" data-bind="template: {name: 'infoTemplate', data: info['leftPanel'], templateOptions:{panel:'leftPanel', detailsVisible:detailsVisible['leftPanel']}}">	</div>
		
				<div class="detailsContainer"> <!-- Only one of these subdivs should be visible at any time -->
					
					<div class="directoryDetails" data-bind="visible: detailsVisible['leftPanel']() == 'entries'">
						<table id="directoryEntriesLeft" class="directoryEntries sortable no-arrow">
							<col class="name"/>
							<col class="mtime"/>
							<col class="size"/>					
							<tr><th class="sortable">Name</th><th class="sortable">Date Modified</th><th class="sortable">Size</th></tr>
							<tbody class="directoryEntriesBody" data-bind="template: {name:'entryTemplate', foreach: entries['leftPanel'], templateOptions:{currentPath:gPath}}"></tbody>
						</table>
					</div>
			
					<div class="fileDetails" data-bind="visible: detailsVisible['leftPanel']() == 'info'">
						<table class="fileDetailsTable"  data-bind="template: {name:'detailsTemplate', data:info['leftPanel']}"></table>
					</div>
			
					<div class="filePreview" data-bind="visible: detailsVisible['leftPanel']() == 'preview'">
						<div class="previewContent"/>
					</div>
				
				</div>
			
			</div>
			
			<div class="noInfo">
				<span data-bind="visible: !(needsSnapshotSelection.leftPanel())">Loading…</span>
				<span data-bind="visible: needsSnapshotSelection.leftPanel()">Select a snapshot.</span>
			</div>
			
		</div>

	</div>
	
	<div id="rightPanel" class="panel">
		

		<div class="sidebar" data-bind="template: {name: 'sidebarTemplate', templateOptions:{panel:'rightPanel', snapshots:snapshots, versions:versions, selectedSnapshot:selectedSnapshot}}">

		</div>
		
		<div class="notSidebar">
			
			<div data-bind="fadeInVisible: info['rightPanel']">
				<div class="infoBox" data-bind="template: {name: 'infoTemplate', data: info['rightPanel'], templateOptions:{panel:'rightPanel', detailsVisible:detailsVisible['rightPanel'], diffable:diffable}}">	</div>
		
				<div class="detailsContainer"> <!-- Only one of these subdivs should be visible at any time -->
					
					<div class="directoryDetails" data-bind="visible: detailsVisible['rightPanel']() == 'entries'">
						<table id="directoryEntriesLeft" class="directoryEntries sortable no-arrow">
							<col class="name"/>
							<col class="mtime"/>
							<col class="size"/>					
							<tr><th class="sortable">Name</th><th class="sortable">Date Modified</th><th class="sortable">Size</th></tr>
							<tbody class="directoryEntriesBody" data-bind="template: {name:'entryTemplate', foreach: entries['rightPanel'], templateOptions:{currentPath:gPath}}"></tbody>
						</table>
					</div>
			
					<div class="fileDetails" data-bind="visible: detailsVisible['rightPanel']() == 'info'">
						<table class="fileDetailsTable"  data-bind="template: {name:'detailsTemplate', data:info['rightPanel']}"></table>
					</div>
			
					<div class="filePreview" data-bind="visible: detailsVisible['rightPanel']() == 'preview'">
						<div class="previewContent"/>
					</div>
				
				</div>
			
			</div>
			
			<div class="noInfo">
				<span data-bind="visible: !(needsSnapshotSelection.rightPanel())">Loading…</span>
				<span data-bind="visible: needsSnapshotSelection.rightPanel()">Select a snapshot.</span>
			</div>
			
		</div>

	</div>

</body>
</html>